<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UCB1 Algorithm Explainer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f9fafb;
            color: #111827;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px 32px 120px;
            min-height: calc(100vh - 80px);
        }

        .scene {
            opacity: 0;
            display: none;
            text-align: center;
            padding-top: 20px;
        }

        .scene.active {
            opacity: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.9; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scene-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #111827;
        }

        .scene-title strong { color: #4f46e5; }

        .info-text {
            font-size: 18px;
            color: #4b5563;
            line-height: 1.7;
            margin: 0 auto 24px;
            max-width: 700px;
        }

        .info-text strong { color: #111827; font-weight: 600; }
        .info-text.small { font-size: 15px; color: #6b7280; margin-top: 20px; }

        .bars-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 14px;
            height: 280px;
            margin: 28px auto;
            padding: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            max-width: 900px;
        }

        .bar-wrapper {
            flex: 1;
            max-width: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .bar-stack {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .bar-base {
            width: 70%;
            border-radius: 6px 6px 0 0;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .bar-uncertainty {
            width: 70%;
            border-radius: 6px 6px 0 0;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            opacity: 0.85;
            animation: shimmer 2s ease-in-out infinite;
        }

        .bar-label {
            margin-top: 10px;
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
        }

        .bar-value {
            font-family: 'Fira Code', monospace;
            font-size: 11px;
            color: #9ca3af;
            margin-top: 4px;
        }

        .ucb-total {
            font-family: 'Fira Code', monospace;
            font-size: 12px;
            font-weight: 700;
            color: #4f46e5;
            margin-top: 2px;
        }

        .selection-count {
            position: absolute;
            top: -28px;
            font-size: 11px;
            font-weight: 600;
            color: #6b7280;
            background: #fff;
            padding: 4px 10px;
            border-radius: 50px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-family: 'Fira Code', monospace;
        }

        .bar-wrapper.selected .bar-stack {
            transform: scale(1.08);
        }

        .bar-wrapper.selected .selection-count {
            background: #4f46e5;
            color: #fff;
        }

        .winner-badge {
            position: absolute;
            top: -50px;
            background: #10b981;
            color: #fff;
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .formula-section {
            background: #fff;
            border-radius: 12px;
            padding: 24px 32px;
            margin: 24px auto;
            max-width: 700px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            animation: slideUp 0.5s ease;
        }

        .formula-title {
            font-size: 12px;
            font-weight: 700;
            color: #6b7280;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .formula {
            font-family: 'Fira Code', monospace;
            font-size: 20px;
            margin: 16px 0;
            color: #374151;
        }

        .formula-q { color: #f59e0b; font-weight: 700; }
        .formula-uncertainty { color: #3b82f6; font-weight: 700; }
        .formula-c { color: #8b5cf6; font-weight: 700; }

        .formula-explanation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .formula-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #f3f4f6;
            border-radius: 8px;
        }

        .formula-icon {
            width: 18px;
            height: 18px;
            border-radius: 4px;
        }

        .formula-text {
            font-size: 14px;
            color: #4b5563;
        }

        .formula-text strong { font-weight: 700; }

        .control-panel {
            background: #fff;
            border-radius: 12px;
            padding: 24px 32px;
            margin: 24px auto;
            max-width: 550px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .control-title {
            font-size: 12px;
            font-weight: 700;
            color: #6b7280;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .slider-display {
            font-size: 40px;
            font-family: 'Fira Code', monospace;
            color: #8b5cf6;
            margin: 16px 0;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            margin: 20px 0;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #8b5cf6;
            cursor: pointer;
            border: 3px solid #fff;
            box-shadow: 0 2px 8px rgba(139,92,246,0.4);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #6b7280;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 24px 0;
        }

        .comparison-card {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .comparison-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .comparison-card.exploitation { border-color: #f59e0b; }
        .comparison-card.exploration { border-color: #3b82f6; }

        .comparison-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 14px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .comparison-card.exploitation .comparison-icon { background: #fef3c7; }
        .comparison-card.exploration .comparison-icon { background: #dbeafe; }

        .comparison-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #111827;
        }

        .comparison-desc {
            font-size: 15px;
            color: #4b5563;
            line-height: 1.6;
        }

        .visual-example {
            margin-top: 16px;
            height: 70px;
            background: #f3f4f6;
            border-radius: 8px;
            display: flex;
            align-items: flex-end;
            padding: 10px;
            gap: 3px;
        }

        .mini-bar {
            flex: 1;
            border-radius: 3px;
        }

        .selection-info {
            margin: 20px auto;
            padding: 14px 20px;
            background: #dbeafe;
            border-radius: 8px;
            max-width: 500px;
            font-size: 15px;
            color: #1e40af;
        }

        .selection-info strong { font-weight: 700; }

        .nav-controls {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 16px;
            background: #fff;
            padding: 12px 24px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 100;
        }

        .nav-btn {
            background: #4f46e5;
            border: none;
            color: white;
            padding: 10px 24px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 15px;
        }

        .nav-btn:hover:not(:disabled) { background: #4338ca; }
        .nav-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .progress-dots {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #d1d5db;
        }

        .progress-dot.active {
            background: #4f46e5;
            width: 24px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="scene active" id="scene0">
            <h1 class="scene-title" style="font-size:32px;margin-bottom:8px;">üìò <strong>UCB1 Algorithm</strong></h1>
            <p class="info-text" style="font-size:16px;margin-bottom:20px;color:#1f2937;">Upper Confidence Bound ‚Äî optimism-based action selection with sublinear regret bounds</p>
            
            <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;flex:1;max-width:1150px;margin:0 auto;width:100%;">
                <div style="background:#fff;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,0.1);text-align:left;display:flex;flex-direction:column;">
                    <div style="font-size:12px;font-weight:700;color:#4f46e5;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;">Core Principle</div>
                    <div style="color:#1f2937;line-height:1.6;font-size:14px;margin-bottom:16px;"><strong>"Optimism in face of uncertainty"</strong> ‚Äî select actions maximizing upper confidence bound, balancing exploitation (high Q) with exploration (high uncertainty).</div>
                    
                    <div style="background:#f8fafc;border-radius:8px;padding:16px;border-left:4px solid #4f46e5;margin-bottom:16px;">
                        <div style="font-family:'Fira Code',monospace;font-size:14px;color:#1f2937;">
                            a* = argmax[<span style="color:#d97706;">Q(a)</span> + <span style="color:#7c3aed;">c</span>√ó<span style="color:#2563eb;">‚àö(ln(t)/N(a))</span>]
                        </div>
                    </div>
                    
                    <div style="font-size:12px;font-weight:700;color:#4f46e5;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">Confidence Bound</div>
                    <div style="font-size:14px;color:#1f2937;line-height:1.7;">
                        Width ‚àù ‚àö(ln(t)/N(a))<br>
                        ‚Ä¢ Grows with total time t<br>
                        ‚Ä¢ Shrinks with action count N(a)
                    </div>
                </div>
                
                <div style="background:#fff;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,0.1);text-align:left;display:flex;flex-direction:column;">
                    <div style="font-size:12px;font-weight:700;color:#4f46e5;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;">Key Components</div>
                    <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:20px;">
                        <span style="background:#fef3c7;color:#78350f;padding:10px 14px;border-radius:6px;font-size:14px;"><strong>Q(a)</strong> ‚Äî Average reward of action a</span>
                        <span style="background:#dbeafe;color:#1e3a8a;padding:10px 14px;border-radius:6px;font-size:14px;"><strong>‚àö(ln t/N)</strong> ‚Äî Uncertainty bonus</span>
                        <span style="background:#ede9fe;color:#5b21b6;padding:10px 14px;border-radius:6px;font-size:14px;"><strong>c</strong> ‚Äî Exploration constant</span>
                        <span style="background:#d1fae5;color:#065f46;padding:10px 14px;border-radius:6px;font-size:14px;"><strong>N(a)</strong> ‚Äî Times action a selected</span>
                    </div>
                    
                    <div style="font-size:12px;font-weight:700;color:#4f46e5;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">C Values</div>
                    <div style="font-size:14px;color:#1f2937;line-height:1.7;">
                        <strong>0.5</strong>: Low exploration (best offline)<br>
                        <strong>‚àö2</strong>: Standard UCB1<br>
                        <strong>2.0+</strong>: High exploration
                    </div>
                </div>
                
                <div style="background:#fff;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,0.1);text-align:left;display:flex;flex-direction:column;">
                    <div style="font-size:12px;font-weight:700;color:#4f46e5;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;">Theoretical Guarantee</div>
                    <div style="background:#f3f4f6;border-radius:6px;padding:12px;margin-bottom:16px;">
                        <div style="font-family:'Fira Code',monospace;font-size:14px;color:#1f2937;">Regret ‚â§ O(‚àö(KT ln T))</div>
                        <div style="font-size:12px;color:#6b7280;margin-top:6px;">K=arms, T=timesteps</div>
                    </div>
                    
                    <div style="font-size:12px;font-weight:700;color:#4f46e5;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">Strengths</div>
                    <div style="font-size:14px;color:#1f2937;line-height:1.8;margin-bottom:16px;">
                        ‚úì Principled uncertainty-based exploration<br>
                        ‚úì Auto reduces exploration over time<br>
                        ‚úì Strong theoretical guarantees
                    </div>
                    
                    <div style="font-size:12px;font-weight:700;color:#4f46e5;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">Weaknesses</div>
                    <div style="font-size:14px;color:#1f2937;line-height:1.8;">
                        ‚úó No context awareness<br>
                        ‚úó Sensitive to c parameter<br>
                        ‚úó Assumes stationary rewards
                    </div>
                </div>
            </div>
            
            <p style="color:#4b5563;font-size:14px;margin-top:20px;">Click <strong style="color:#111827;">Next</strong> to see how UCB1 balances exploration and exploitation ‚Üí</p>
        </div>

        <div class="scene" id="scene1">
            <h1 class="scene-title">The <strong>UCB1</strong> Algorithm</h1>
            <p class="info-text">
                Upper Confidence Bound balances exploitation and exploration by adding an <strong>uncertainty bonus</strong> 
                to each action's value estimate. Actions with fewer selections get a larger bonus.
            </p>
            <div class="bars-container" id="barsScene1"></div>
            <p class="info-text small">Solid bar = Q-value (average reward) ‚Ä¢ Dashed top = Uncertainty bonus (exploration incentive)</p>
        </div>

        <div class="scene" id="scene2">
            <h1 class="scene-title"><strong>UCB1</strong> Formula</h1>
            <p class="info-text">Each action's score combines its average reward (exploitation) with an uncertainty term (exploration).</p>
            <div class="formula-section">
                <div class="formula-title">Upper Confidence Bound</div>
                <div class="formula">UCB(a) = <span class="formula-q">Q(a)</span> + <span class="formula-c">c</span> √ó <span class="formula-uncertainty">‚àö(ln(t) / N(a))</span></div>
                <div class="formula-explanation">
                    <div class="formula-item">
                        <div class="formula-icon" style="background:#fef3c7;"></div>
                        <div class="formula-text"><strong>Q(a)</strong> ‚Äî Average reward</div>
                    </div>
                    <div class="formula-item">
                        <div class="formula-icon" style="background:#dbeafe;"></div>
                        <div class="formula-text"><strong>Bonus</strong> ‚Äî Uncertainty term</div>
                    </div>
                    <div class="formula-item">
                        <div class="formula-icon" style="background:#ede9fe;"></div>
                        <div class="formula-text"><strong>c</strong> ‚Äî Exploration parameter</div>
                    </div>
                </div>
            </div>
            <div class="bars-container" id="barsScene2"></div>
        </div>

        <div class="scene" id="scene3">
            <h1 class="scene-title">Fewer Selections = <strong>Larger Bonus</strong></h1>
            <p class="info-text">Actions selected less often have higher uncertainty, resulting in a taller bonus layer.</p>
            <div class="selection-info">Watch: Actions with <strong>low n</strong> (few selections) get a <strong>tall uncertainty bonus</strong> to encourage exploration!</div>
            <div class="bars-container" id="barsScene3"></div>
            <p class="info-text small">The algorithm balances: well-known actions (small bonus) vs. uncertain actions (large bonus)</p>
        </div>

        <div class="scene" id="scene4">
            <h1 class="scene-title">Adjusting Exploration with <strong>c</strong></h1>
            <p class="info-text">The hyperparameter c controls how much we value exploration. Larger c ‚Üí more exploration.</p>
            <div class="control-panel">
                <div class="control-title">Exploration Parameter</div>
                <div class="slider-display">c = <span id="cValue">1.41</span></div>
                <input type="range" min="0" max="300" value="141" class="slider" id="cSlider">
                <div class="slider-labels">
                    <span>0.0 (Pure Exploit)</span>
                    <span>1.41 (Balanced)</span>
                    <span>3.0 (High Explore)</span>
                </div>
            </div>
            <div class="bars-container" id="barsScene4"></div>
        </div>

        <div class="scene" id="scene5">
            <h1 class="scene-title"><strong>UCB1:</strong> The Complete Picture</h1>
            <p class="info-text">UCB1 elegantly combines exploitation with exploration in a single formula.</p>
            <div class="comparison-grid">
                <div class="comparison-card exploitation">
                    <div class="comparison-icon">‚≠ê</div>
                    <div class="comparison-title">Exploitation</div>
                    <div class="comparison-desc">Uses Q(a) ‚Äî the average reward from past selections. Prefers proven high returns.</div>
                    <div class="visual-example" id="exploitViz"></div>
                </div>
                <div class="comparison-card exploration">
                    <div class="comparison-icon">üîç</div>
                    <div class="comparison-title">Exploration</div>
                    <div class="comparison-desc">Uses uncertainty bonus ‚Äî grows when action is under-sampled. Ensures we don't miss better options.</div>
                    <div class="visual-example" id="exploreViz"></div>
                </div>
            </div>
            <div class="formula-section">
                <div class="formula" style="font-size:18px;">Best Action = argmax<sub>a</sub> [ <span class="formula-q">Q(a)</span> + <span class="formula-c">c</span> √ó <span class="formula-uncertainty">‚àö(ln(t) / N(a))</span> ]</div>
            </div>
        </div>

        <div class="nav-controls">
            <button class="nav-btn" id="prevBtn" onclick="previousScene()">‚Üê Previous</button>
            <div class="progress-dots" id="progressDots"></div>
            <button class="nav-btn" id="nextBtn" onclick="nextScene()">Next ‚Üí</button>
        </div>
    </div>

    <script>
        const NUM_ACTIONS = 8;
        const COLORS = ['#ec4899','#3b82f6','#10b981','#f59e0b','#8b5cf6','#ef4444','#14b8a6','#f97316'];
        const LIGHT = ['#fce7f3','#dbeafe','#d1fae5','#fef3c7','#ede9fe','#fee2e2','#ccfbf1','#ffedd5'];

        let currentScene = 0;
        const totalScenes = 6;
        let qValues = [8.5, 5.2, 7.0, 3.5, 6.2, 4.0, 7.8, 2.8];
        let selectionCounts = [45, 8, 25, 2, 15, 5, 35, 1];
        let totalSelections = 100;
        let cParameter = 1.41;
        let animationInterval = null;

        function init() {
            createProgressDots();
            renderBars('barsScene1', false, false);
            renderBars('barsScene2', true, true);
            renderBars('barsScene3', true, true);
            renderBars('barsScene4', true, true);
            createComparisonViz();
            startAnimations();
        }

        function calcUncertainty(n, c = cParameter) {
            return n === 0 ? 10 : c * Math.sqrt(Math.log(totalSelections) / n);
        }

        function renderBars(id, showCounts, showUCB = false) {
            const container = document.getElementById(id);
            if (!container) return;
            container.innerHTML = '';

            const ucbScores = qValues.map((q, i) => q + calcUncertainty(selectionCounts[i]));
            const maxUCB = Math.max(...ucbScores);
            const winnerIdx = ucbScores.indexOf(maxUCB);

            qValues.forEach((q, i) => {
                const u = calcUncertainty(selectionCounts[i]);
                const ucb = q + u;
                const qH = (q / 10) * 140;
                const uH = u * 20;
                const isWinner = showUCB && i === winnerIdx;

                const wrapper = document.createElement('div');
                wrapper.className = 'bar-wrapper' + (isWinner ? ' selected' : '');
                wrapper.style.animationDelay = `${i * 0.05}s`;
                wrapper.innerHTML = `
                    <div class="bar-stack">
                        ${isWinner ? '<div class="winner-badge">‚òÖ Best</div>' : ''}
                        ${showCounts ? `<div class="selection-count">n=${selectionCounts[i]}</div>` : ''}
                        <div class="bar-uncertainty" style="height:${uH}px;background:${LIGHT[i]};box-shadow:0 0 20px ${LIGHT[i]};animation-delay:${i * 0.1}s;border:2px dashed ${COLORS[i]}40;"></div>
                        <div class="bar-base" style="height:${qH}px;background:${COLORS[i]};"></div>
                    </div>
                    <div class="bar-label">Action ${i + 1}</div>
                    <div class="bar-value">Q: ${q.toFixed(1)} ${showCounts ? `<span style="color:${COLORS[i]}">+${u.toFixed(1)}</span>` : ''}</div>
                    ${showUCB ? `<div class="ucb-total">UCB: ${ucb.toFixed(1)}</div>` : ''}
                `;
                container.appendChild(wrapper);
            });
        }

        function updateBars(id) {
            renderBars(id, true, true);
        }

        function createComparisonViz() {
            const exploitViz = document.getElementById('exploitViz');
            const exploreViz = document.getElementById('exploreViz');

            for (let i = 0; i < 8; i++) {
                exploitViz.innerHTML += `<div class="mini-bar" style="height:${30 + Math.random() * 50}%;background:${COLORS[i]};"></div>`;
            }

            const counts = [25, 5, 30, 3, 20, 8, 18, 6];
            for (let i = 0; i < 8; i++) {
                const u = calcUncertainty(counts[i], 1.5) * 6;
                const base = 20 + Math.random() * 20;
                exploreViz.innerHTML += `<div style="flex:1;display:flex;flex-direction:column;align-items:center;">
                    <div class="mini-bar" style="height:${u}%;background:${LIGHT[i]};opacity:0.8;"></div>
                    <div class="mini-bar" style="height:${base}%;background:${COLORS[i]};"></div>
                </div>`;
            }
        }

        function createProgressDots() {
            const c = document.getElementById('progressDots');
            for (let i = 0; i < totalScenes; i++) {
                const d = document.createElement('div');
                d.className = 'progress-dot' + (i === currentScene ? ' active' : '');
                c.appendChild(d);
            }
        }

        function nextScene() {
            if (currentScene < totalScenes - 1) {
                stopAnimations();
                document.getElementById(`scene${currentScene}`).classList.remove('active');
                currentScene++;
                document.getElementById(`scene${currentScene}`).classList.add('active');
                updateNavigation();
                window.scrollTo(0, 0);
                startAnimations();
            }
        }

        function previousScene() {
            if (currentScene > 0) {
                stopAnimations();
                document.getElementById(`scene${currentScene}`).classList.remove('active');
                currentScene--;
                document.getElementById(`scene${currentScene}`).classList.add('active');
                updateNavigation();
                window.scrollTo(0, 0);
                startAnimations();
            }
        }

        function updateNavigation() {
            document.getElementById('prevBtn').disabled = currentScene === 0;
            document.getElementById('nextBtn').disabled = currentScene === totalScenes - 1;
            document.querySelectorAll('.progress-dot').forEach((d, i) => d.classList.toggle('active', i === currentScene));
        }

        function startAnimations() {
            if (currentScene === 3) {
                let step = 0;
                const countPatterns = [
                    [45, 8, 25, 2, 15, 5, 35, 1],
                    [46, 8, 25, 2, 15, 5, 35, 1],
                    [46, 8, 25, 2, 15, 5, 35, 2],
                    [46, 8, 25, 3, 15, 5, 35, 2],
                    [46, 9, 25, 3, 15, 5, 35, 2],
                    [46, 9, 25, 3, 15, 6, 35, 2],
                ];
                function animate() {
                    selectionCounts = countPatterns[step % countPatterns.length];
                    renderBars('barsScene3', true, true);
                    step++;
                }
                animate();
                animationInterval = setInterval(animate, 1500);
            }
        }

        function stopAnimations() {
            if (animationInterval) { clearInterval(animationInterval); animationInterval = null; }
        }

        document.getElementById('cSlider').addEventListener('input', e => {
            cParameter = e.target.value / 100;
            document.getElementById('cValue').textContent = cParameter.toFixed(2);
            updateBars('barsScene4');
        });

        window.addEventListener('load', () => { init(); updateNavigation(); });
    </script>
</body>
</html>
